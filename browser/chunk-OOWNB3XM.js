import{a as b}from"./chunk-YZGN7GNK.js";import{a as g,e as n}from"./chunk-IQVJWSD3.js";var{GONE:M}=b,L=/constructor/i.test(window.HTMLElement)||window.safari||window.WebKitPoint,R=class{constructor(e="unknown"){this.kind="file",this.writable=!0,this.name=e}getFile(){return n(this,null,function*(){throw new DOMException(...M)})}createWritable(){return n(this,arguments,function*(e={}){var t;if(e.keepExistingData)throw new TypeError("Option keepExistingData is not implemented");let y=globalThis.TransformStream||(yield import("./chunk-EZ6UOCSQ.js")).TransformStream,_=globalThis.WritableStream||(yield import("./chunk-EZ6UOCSQ.js")).WritableStream,r=yield(t=navigator.serviceWorker)===null||t===void 0?void 0:t.getRegistration(),a=document.createElement("a"),i=new y,v=i.writable;if(a.download=this.name,L||!r){let o=[];i.readable.pipeTo(new _({write(s){o.push(new Blob([s]))},close(){let s=new Blob(o,{type:"application/octet-stream; charset=utf-8"});o=[],a.href=URL.createObjectURL(s),a.click(),setTimeout(()=>URL.revokeObjectURL(a.href),1e4)}}))}else{let{writable:o,readablePort:s}=new p(_),c=encodeURIComponent(this.name).replace(/['()]/g,escape).replace(/\*/g,"%2A"),T=g({"content-disposition":"attachment; filename*=UTF-8''"+c,"content-type":"application/octet-stream; charset=utf-8"},e.size?{"content-length":e.size}:{}),E=setTimeout(()=>r.active.postMessage(0),1e4);i.readable.pipeThrough(new y({transform(h,w){if(h instanceof Uint8Array)return w.enqueue(h);let P=new Response(h).body.getReader(),u=j=>P.read().then(f=>f.done?0:u(w.enqueue(f.value)));return u()}})).pipeTo(o).finally(()=>{clearInterval(E)}),r.active.postMessage({url:r.scope+c,headers:T,readablePort:s},[s]);let l=document.createElement("iframe");l.hidden=!0,l.src=r.scope+c,document.body.appendChild(l)}return v.getWriter()})}isSameEntry(e){return n(this,null,function*(){return this===e})}},O=0,U=0,k=1,S=1,W=2,d=class{constructor(e){this._readyPending=!1,this._port=e,this._resetReady(),this._port.onmessage=t=>this._onMessage(t.data)}start(e){return this._controller=e,this._readyPromise}write(e){let t={type:O,chunk:e};return this._port.postMessage(t,[e.buffer]),this._resetReady(),this._readyPromise}close(){this._port.postMessage({type:W}),this._port.close()}abort(e){this._port.postMessage({type:S,reason:e}),this._port.close()}_onMessage(e){e.type===U&&this._resolveReady(),e.type===k&&this._onError(e.reason)}_onError(e){this._controller.error(e),this._rejectReady(e),this._port.close()}_resetReady(){this._readyPromise=new Promise((e,t)=>{this._readyResolve=e,this._readyReject=t}),this._readyPending=!0}_resolveReady(){this._readyResolve(),this._readyPending=!1}_rejectReady(e){this._readyPending||this._resetReady(),this._readyPromise.catch(()=>{}),this._readyReject(e),this._readyPending=!1}},p=class{constructor(e){let t=new MessageChannel;this.readablePort=t.port1,this.writable=new e(new d(t.port2))}};export{R as FileHandle};
