import{a as y}from"./chunk-4IKNMZFP.js";import{b as p}from"./chunk-J5UMYUBC.js";import{a as c,b}from"./chunk-YZGN7GNK.js";import{e as o,f as m,g as d}from"./chunk-IQVJWSD3.js";var{INVALID:z,GONE:g,SYNTAX:f,DISALLOWED:F}=c,h=class{constructor(e,i,t,r){this.fileHandle=e,this.writer=t,this.file=r?i:new File([],i.name,i),this.size=r?i.size:0,this.position=0}write(e){return o(this,null,function*(){try{yield this.fileHandle.getFile()}catch{throw new DOMException(...g)}let i=this.file;if(b(e)){if(e.type==="write"){if(typeof e.position=="number"&&e.position>=0&&(this.position=e.position,this.size<e.position&&(this.file=new File([this.file,new ArrayBuffer(e.position-this.size)],this.file.name,this.file))),!("data"in e))throw new DOMException(...f("write requires a data argument"));e=e.data}else if(e.type==="seek")if(Number.isInteger(e.position)&&e.position>=0){if(this.size<e.position)throw new DOMException(...z);this.position=e.position;return}else throw new DOMException(...f("seek requires a position argument"));else if(e.type==="truncate")if(Number.isInteger(e.size)&&e.size>=0){i=e.size<this.size?new File([i.slice(0,e.size)],i.name,i):new File([i,new Uint8Array(e.size-this.size)],i.name,i),this.size=i.size,this.position>i.size&&(this.position=i.size),this.file=i;return}else throw new DOMException(...f("truncate requires a size argument"))}e=new Blob([e]);let t=this.file,r=t.slice(0,this.position),s=t.slice(this.position+e.size),w=this.position-r.size;w<0&&(w=0),t=new File([r,new Uint8Array(w),e,s],t.name),this.size=t.size,this.position+=e.size,this.file=t})}close(){return o(this,null,function*(){try{yield this.fileHandle.getFile()}catch{throw new DOMException(...g)}let e=yield new Promise((i,t)=>{let r=new FileReader;r.onload=()=>i(r.result),r.onerror=t,r.readAsArrayBuffer(this.file)});this.file=new File([e],this.file.name,this.file),yield new Promise((i,t)=>{this.writer.onwriteend=i,this.writer.onerror=t,this.writer.truncate(0)}),yield new Promise((i,t)=>{this.writer.onwriteend=i,this.writer.onerror=t,this.writer.write(this.file)}),this.writer.onwriteend=null,this.writer.onerror=null,this.file=this.position=this.size=null})}},a=class{constructor(e,i=!0){this.kind="file",this.readable=!0,this.file=e,this.writable=i}get name(){return this.file.name}isSameEntry(e){return o(this,null,function*(){return this.file.toURL()===e.file.toURL()})}getFile(){return new Promise(this.file.file.bind(this.file))}createWritable(e){return o(this,null,function*(){if(!this.writable)throw new DOMException(...F);let i=yield this.getFile();return new Promise((t,r)=>this.file.createWriter(s=>{t(new h(this,i,s,!!e.keepExistingData))},r))})}},l=class n{constructor(e,i=!0){this.kind="directory",this.readable=!0,this.dir=e,this.writable=i,this.name=e.name}isSameEntry(e){return o(this,null,function*(){return this.dir.fullPath===e.dir.fullPath})}entries(){return d(this,null,function*(){let e=this.dir.createReader(),i=yield new m(new Promise(e.readEntries.bind(e)));for(let t of i)yield[t.name,t.isFile?new a(t,this.writable):new n(t,this.writable)]})}getDirectoryHandle(e,i={}){return new Promise((t,r)=>{this.dir.getDirectory(e,i,s=>{t(new n(s))},r)})}getFileHandle(e,i={}){return new Promise((t,r)=>this.dir.getFile(e,i,s=>t(new a(s)),r))}removeEntry(e,i){return o(this,null,function*(){let t;try{t=yield this.getDirectoryHandle(e)}catch(r){if(r.name==="TypeMismatchError")t=yield this.getFileHandle(e);else throw r}return new Promise((r,s)=>{t instanceof n?i?.recursive?t.dir.removeRecursively(()=>r(),s):t.dir.remove(()=>r(),s):t.file&&t.file.remove(()=>r(),s)})})}};globalThis.DataTransferItem&&!globalThis.DataTransferItem.prototype.getAsFileSystemHandle&&globalThis.DataTransferItem.prototype.webkitGetAsEntry&&(globalThis.DataTransferItem.prototype.getAsFileSystemHandle=function(){return o(this,null,function*(){let n=this.webkitGetAsEntry();return n.isFile?new p(new a(n,!1)):new y(new l(n,!1))})});
