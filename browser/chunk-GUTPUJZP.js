import{a as y,b as x}from"./chunk-YZGN7GNK.js";import{e as s,g as c,h as d}from"./chunk-IQVJWSD3.js";var l=globalThis.File,E=globalThis.Blob,_=r=>{l=r},I=r=>{E=r},{INVALID:D,GONE:n,MISMATCH:z,MOD_ERR:M,SYNTAX:a,DISALLOWED:b}=y,w=class{constructor(e,i){this.fileHandle=e,this.file=i?e.file:new l([],e.file.name,e.file),this.size=i?e.file.size:0,this.position=0}write(e){return s(this,null,function*(){if(!this.fileHandle.file)throw new DOMException(...n);let i=this.file;if(x(e)){if(e.type==="write"){if(typeof e.position=="number"&&e.position>=0&&(this.position=e.position,this.size<e.position&&(this.file=new l([this.file,new ArrayBuffer(e.position-this.size)],this.file.name,this.file))),!("data"in e))throw new DOMException(...a("write requires a data argument"));e=e.data}else if(e.type==="seek")if(Number.isInteger(e.position)&&e.position>=0){if(this.size<e.position)throw new DOMException(...D);this.position=e.position;return}else throw new DOMException(...a("seek requires a position argument"));else if(e.type==="truncate")if(Number.isInteger(e.size)&&e.size>=0){i=e.size<this.size?new l([i.slice(0,e.size)],i.name,i):new l([i,new Uint8Array(e.size-this.size)],i.name,i),this.size=i.size,this.position>i.size&&(this.position=i.size),this.file=i;return}else throw new DOMException(...a("truncate requires a size argument"))}e=new E([e]);let o=this.file,t=o.slice(0,this.position),O=o.slice(this.position+e.size),h=this.position-t.size;h<0&&(h=0),o=new l([t,new Uint8Array(h),e,O],o.name),this.size=o.size,this.position+=e.size,this.file=o})}close(){return s(this,null,function*(){if(!this.fileHandle.file)throw new DOMException(...n);this.fileHandle.file=this.file,this.file=this.position=this.size=null,this.fileHandle.onclose&&this.fileHandle.onclose(this.fileHandle)})}},f=class{constructor(e="",i=new l([],e),o=!0){this.kind="file",this.deleted=!1,this.file=i,this.name=e,this.writable=o}getFile(){return s(this,null,function*(){if(this.deleted||this.file===null)throw new DOMException(...n);return this.file})}createWritable(e){return s(this,null,function*(){if(!this.writable)throw new DOMException(...b);if(this.deleted)throw new DOMException(...n);return new w(this,!!e?.keepExistingData)})}isSameEntry(e){return s(this,null,function*(){return this===e})}destroy(){this.deleted=!0,this.file=null}},p=class r{constructor(e,i=!0){this.kind="directory",this.deleted=!1,this._entries={},this.name=e,this.writable=i}entries(){return c(this,null,function*(){if(this.deleted)throw new DOMException(...n);yield*d(Object.entries(this._entries))})}isSameEntry(e){return s(this,null,function*(){return this===e})}getDirectoryHandle(o){return s(this,arguments,function*(e,i={}){if(this.deleted)throw new DOMException(...n);let t=this._entries[e];if(t){if(t instanceof f)throw new DOMException(...z);return t}else{if(i.create)return this._entries[e]=new r(e);throw new DOMException(...n)}})}getFileHandle(o){return s(this,arguments,function*(e,i={}){let t=this._entries[e];if(t){if(t instanceof f)return t;throw new DOMException(...z)}else{if(i.create)return this._entries[e]=new f(e);throw new DOMException(...n)}})}removeEntry(o){return s(this,arguments,function*(e,i={}){let t=this._entries[e];if(!t)throw new DOMException(...n);t.destroy(i.recursive),delete this._entries[e]})}destroy(e){for(let i of Object.values(this._entries)){if(!e)throw new DOMException(...M);i.destroy(e)}this._entries={},this.deleted=!0}},m=new p(""),g=()=>m,A=g;export{f as FileHandle,p as FolderHandle,A as default,I as setBlobImpl,_ as setFileImpl};
